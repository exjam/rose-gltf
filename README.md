# rose-gltf

## Generating lightmaps using Blender

### Setup
Install The Lightmapper:
  - https://github.com/Naxela/The_Lightmapper/wiki/0.-Installing-The-Lightmapper

Install a denoiser (I have only tested OIDN):
  - https://github.com/Naxela/The_Lightmapper/wiki/2.-Installing-OIDN-or-Optix-denoiser

Latest releases for ODIN can be found here:
  - https://github.com/OpenImageDenoise/oidn/releases

### Workflow
#### Convert a zone to GLTF
To convert a whole zone:

`rose-gltf --out=zant.glb "F:\\rose\\narose\\svn-rose-online\\assets\\3ddata\\maps\\junon\\jdt01\\jdt01.zon"`

You can also convert only a single block if you want to iterate on light settings faster:

`rose-gltf --out=zant_32_32.glb --filter-block-x=32 --filter-block-y=32 "F:\\rose\\narose\\svn-rose-online\\assets\\3ddata\\maps\\junon\\jdt01\\jdt01.zon"`

Where:
- `--out` is the path to the output gltf file
- `--filter-block-x` and  `--filter-block-y` allow you to convert only a single .IFO block for quicker iteration

#### Import GLTF to blender
File -> Import -> Import GLTF

#### Edit Render Properties
Edit the Render Properties in blender.

```
The Lightmapper
  > Cycles Settings
    > Device = GPU
    > Resolution = Scale 1/1
    > Quality = Production
    > Lightmap Directory = choose an output path, this will be the path you give to make-lit
  > Denoise
    > Enable a denoiser and point it to one you downloaded
  > Encoding
    > Encoding Mode HDR
    > Format EXR
```

#### Start bake

You might want to enable the system console to see the progress of lightmapping, as blender will becoming unresponsive whilst rendering is ongoing.

` Window > Toggle System Console `

To start the lightmap bake:

`Render Properties -> The Lightmapper -> Build Lightmaps`

#### Convert generated lightmaps to ROSE format
This can be done with the make-lit tool, e.g. for zant you might do:

`make-lit --input "<baked lightmaps directory>" --output "..path to../3ddata/maps/junon/jdt01" --texconv "...path to.../texconv.exe"`

Where:
- `--input` is the path to the directory containing the lightmaps generated by blender
- `--output` is the path to output the lightmap data for ROSE
- `--texconv` is the path to TexConv.exe which is used to generate .DDS files
